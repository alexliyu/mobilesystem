<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Strict//EN'
'http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd'>
<html><head>
<title>mobile.mobile.molly.maps.osm.__init__</title>
<style>
body {
    background:white;
    margin: 0em 1em 10em 1em;
    color: black;
}

h1 { color: white; background: #4FA4FF; }
h2 { color: white; background: #4FA4FF; }
h3 { color: white; background: #00557F; }
h4 { color: white; background: #00557F; }
    
a { color: #AA5500; }

</style>
</head>
<body><a NAME="top" ID="top"></a>
<h1>mobile.mobile.molly.maps.osm.__init__</h1>

<h3>Global Attributes</h3>
<table>
<tr><td>MARKER_COLORS</td></tr><tr><td>MARKER_RANGE</td></tr><tr><td>logger</td></tr>
</table>
<h3>Classes</h3>
<table>
<tr><td>None</td></tr>
</table>
<h3>Functions</h3>
<table>
<tr>
<td><a href="#fit_to_map">fit_to_map</a></td>
<td>Given a list of points and some minimum number of points, then a "fitted map" is generated, which is one which contains at least @C{min_points}, and is at least at the zoom level @C{zoom}, but also contains any other points in the list which is inside the bounding area of this minimal map.</td>
</tr><tr>
<td><a href="#get_or_create_map">get_or_create_map</a></td>
<td>A wrapper function for a map generator which protects against race conditions in map generation.</td>
</tr>
</table>
<hr /><hr />
<a NAME="get_or_create_map" ID="get_or_create_map"></a>
<h2>get_or_create_map</h2>
<b>get_or_create_map</b>(<i>generator, args</i>)
<p>
    A wrapper function for a map generator which protects against race
    conditions in map generation. You should use this instead of calling a
    generator directly.
</p><dl>
<dt><i>generator:</i></dt>
<dd>
The generator to use
</dd><dt><i>args:</i></dt>
<dd>
Any extra arguments to pass to the generator function
    This assumes that generator is functional, i.e. its return value is
    determined solely by its arguments. In the case that a map is requested
    again before the original map generation has finished, the following
    happens:
    * Nothing has yet been saved to the database as we have to wait for the
      metadata to come back. Hence, we get a DoesNotExist.
    * The map is regenerated. Due to the atomic nature of filesystem writes
      we can guarantee that we won't get a funnily spliced file written by
      the function f.
    * The first call saves the GeneratedMap instance to the database.
    * The second call attempts to do the same, but it would result in a
      duplicate primary key, and so it throws an IntegrityError.
    * Due to the functional nature of f, we know we have the correct metadata
      for the map that has been generated, and that it will match that
      already stored in the database. As such, we can leave the database
      alone and return the metadata just generated.
    Assuming that if we get a DoesNotExist that there won't be one by the
    time we come to write leads to a race condition given the non-zero
    duration of f. Subsequent attempts to get the map with that hash then
    throws a MultipleObjectsReturned exception. Yes, this did happen. Seven
    times, no less.
</dd>
</dl>
<div align="right"><a href="#top">Up</a></div>
<hr />
</body></html>